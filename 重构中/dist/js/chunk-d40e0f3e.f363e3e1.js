(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d40e0f3e"],{"2d1f":function(t,e,a){t.exports=a("b606")},"386d":function(t,e,a){"use strict";var n=a("cb7c"),s=a("83a1"),r=a("5f1b");a("214f")("search",1,function(t,e,a,l){return[function(a){var n=t(this),s=void 0==a?void 0:a[e];return void 0!==s?s.call(a,n):new RegExp(a)[e](String(n))},function(t){var e=l(a,t,this);if(e.done)return e.value;var i=n(t),o=String(this),c=i.lastIndex;s(c,0)||(i.lastIndex=0);var u=r(i,o);return s(i.lastIndex,c)||(i.lastIndex=c),null===u?-1:u.index}]})},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"9c60":function(t,e,a){var n=a("63b6"),s=a("13c8")(!0);n(n.S,"Object",{entries:function(t){return s(t)}})},b606:function(t,e,a){a("9c60"),t.exports=a("584a").Object.entries},c680:function(t,e,a){"use strict";var n=a("5176"),s=a.n(n),r=(a("96cf"),a("3b8d")),l=(a("386d"),a("cebc"));e["a"]={data:function(){return{search:{},searchAdvanced:{},searchInEffect:{},data:[],loading:!1,page:{total:0,current:1,size:10}}},watch:{search:{deep:!0,handler:function(t){this.mergeSearch(t)}}},created:function(){var t=this;this.searchInEffect=Object(l["a"])({},this.search,this.searchAdvanced),this.$watch("searchInEffect",function(){t.page.current=1,t.getList()},{deep:!0})},methods:{getList:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a,n,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,e=this.page,t.next=5,this.$axios.post(this.url,{offset:e.size*(e.current-1),limit:e.size,params:this.searchInEffect});case 5:a=t.sent,n=a.data,s=n.data,r=n.recordsTotal,this.data=s,this.page.total=r;case 11:return t.prev=11,this.loading=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[1,,11,14]])}));function e(){return t.apply(this,arguments)}return e}(),mergeSearch:function(t){s()(this.searchInEffect,t)}}}},d6d1:function(t,e,a){"use strict";var n,s,r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"load",rawName:"v-load",value:t.loading,expression:"loading"}],staticClass:"contract-add"},[a("el-form",{ref:"form",staticClass:"flex",attrs:{"label-position":"top",rules:t.formRules,model:t.formData}},[a("div",{staticClass:"flex-grow-lazy-1"},[a("kld-card",{attrs:{title:"合同基础信息",noHeadIcon:""}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"合同编号",prop:"contractCode"}},[a("el-input",{attrs:{placeholder:"请输入合同编号"},model:{value:t.formData.contractCode,callback:function(e){t.$set(t.formData,"contractCode",e)},expression:"formData.contractCode"}})],1)],1),a("el-col",{attrs:{span:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"合同名称",prop:"contractName"}},[a("el-input",{attrs:{placeholder:"请输入合同名称"},model:{value:t.formData.contractName,callback:function(e){t.$set(t.formData,"contractName",e)},expression:"formData.contractName"}})],1)],1),a("el-col",{attrs:{span:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"签订日期",prop:"signDate"}},[a("el-date-picker",{attrs:{placeholder:"请输入签订日期"},model:{value:t.formData.signDate,callback:function(e){t.$set(t.formData,"signDate",e)},expression:"formData.signDate"}})],1)],1),a("el-col",{attrs:{span:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"合同类型",prop:"contractType"}},[a("el-select",{attrs:{placeholder:"请选择合同类型"},model:{value:t.formData.contractType,callback:function(e){t.$set(t.formData,"contractType",e)},expression:"formData.contractType"}},[a("el-option",{attrs:{value:1,label:"维保合同"}}),a("el-option",{attrs:{value:2,label:"采购合同"}}),a("el-option",{attrs:{value:3,label:"维修合同"}}),a("el-option",{attrs:{value:4,label:"其它"}})],1)],1)],1),a("el-col",{attrs:{span:12,md:8,lg:6}},[a("kld-form-item",{attrs:{"label-width":"100%",prop:"supplierId"},scopedSlots:t._u([{key:"label",fn:function(e){var n=e.Asterisk;return a("div",{staticClass:"flex justify-content-between"},[a("span",[t._v("\n                                    供应商名称\n                                    "),a(n,{tag:"component",staticClass:"pl-4"})],1),a("span",[t._v("\n                                    供应商未入库？\n                                    "),a("router-link",{attrs:{to:{name:"supplier-add"}}},[t._v("点击新增")])],1)])}}])},[a("select-supplier",{model:{value:t.supplier,callback:function(e){t.supplier=e},expression:"supplier"}})],1)],1),a("el-col",{attrs:{span:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"联系人",prop:"supplierContactor"}},[a("el-input",{attrs:{value:t.formData.supplierContactor,placeholder:"系统自动带入",disabled:""}})],1)],1),a("el-col",{attrs:{span:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"联系方式",prop:"supplierContact"}},[a("el-input",{attrs:{value:t.formData.supplierContact,placeholder:"系统自动带入",disabled:""}})],1)],1),a("el-col",{attrs:{span:12,md:8,lg:6}},[a("el-form-item",{attrs:{label:"采购金额",prop:"purchaseAmount"}},[a("kld-input-number",{attrs:{precision:2,min:0,placeholder:"请输入采购金额",disabled:!t.isAdd},model:{value:t.formData.purchaseAmount,callback:function(e){t.$set(t.formData,"purchaseAmount",e)},expression:"formData.purchaseAmount"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("￥")])])],1)],1)],1)],1),a("kld-card",{staticClass:"mt-10",attrs:{title:"分期付款项","no-head-icon":""}},[a("el-form-item",{attrs:{label:"分期数",prop:"periodsNum"}},[a("el-row",{staticClass:"flex align-items-center",attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("kld-input-number",{attrs:{placeholder:"请输入分期数",min:0,precision:0,"default-value":0,disabled:!t.isAdd},model:{value:t.periods,callback:function(e){t.periods=e},expression:"periods"}},[a("template",{slot:"append"},[t._v("期")])],2)],1),t.isAdd?a("el-col",{attrs:{span:18}},[a("span",{staticClass:"text-orange flex-shrink-0"},[t._v("*请填写合同实际分期数，并完善分期详情表格内容")])]):t._e()],1)],1),a("installment-payment",{attrs:{periods:t.formData.periodsNum,total:t.formData.purchaseAmount,disabled:!t.isAdd,"status-editable":t.isEdit},model:{value:t.formData.paymentInstalments,callback:function(e){t.$set(t.formData,"paymentInstalments",e)},expression:"formData.paymentInstalments"}})],1),a("kld-card",{staticClass:"mt-10",attrs:{title:"合同所含设备","no-head-icon":""}},[a("contract-assets",{model:{value:t.formData.assetIds,callback:function(e){t.$set(t.formData,"assetIds",e)},expression:"formData.assetIds"}})],1),a("kld-card",{staticClass:"mt-10",attrs:{title:"合同所含备件","no-head-icon":""}},[a("contract-spare-parts",{attrs:{assets:t.formData.assetIds},model:{value:t.formData.spareParts,callback:function(e){t.$set(t.formData,"spareParts",e)},expression:"formData.spareParts"}})],1)],1),a("div",{staticClass:"flex-shrink-0 ml-20",staticStyle:{width:"400px"}},[t.isEdit?a("kld-card",{attrs:{title:"合同状态","body-class-name":"empty-none"}},[a("el-radio-group",{attrs:{slot:"head-icon"},slot:"head-icon",model:{value:t.formData.contractStatus,callback:function(e){t.$set(t.formData,"contractStatus",e)},expression:"formData.contractStatus"}},[a("el-radio",{attrs:{label:0}},[t._v("正常")]),a("el-radio",{attrs:{label:1}},[t._v("废弃")])],1)],1):t._e(),a("kld-card",{attrs:{title:"添加标签"}},[a("span",{staticClass:"text-secondary",attrs:{slot:"head-icon"},slot:"head-icon"},[t._v("单台资产最多添加5个标签")]),a("select-contract-tag",{model:{value:t.formData.labelIds,callback:function(e){t.$set(t.formData,"labelIds",e)},expression:"formData.labelIds"}})],1),a("kld-card",{attrs:{title:"合同图片"}},[a("span",{staticClass:"text-secondary",attrs:{slot:"head-icon"},slot:"head-icon"},[t._v("支持上传最多5张图片或单个图片最大3M")]),a("file-upload",{ref:"file-upload",attrs:{"action-image":t.imageAction,images:t.formData.pics,accept:[".jpeg",".jpg",".png",".gif"],limit:5,"max-size":3145728},on:{"update:images":function(e){t.$set(t.formData,"pics",e)}}})],1)],1)]),a("Portal",{attrs:{to:"action"}},[a("div",{staticClass:"full-width justify-content-end flex pr-tips"},[a("el-button",{attrs:{size:"large",loading:t.submitLoading},on:{click:t.submit}},[t._v("提交")]),a("el-button",{attrs:{type:"default",size:"large"},on:{click:t.goBack}},[t._v("返回")])],1)])],1)},l=[],i=(a("c5f6"),a("768b")),o=a("2d1f"),c=a.n(o),u=a("5d73"),d=a.n(u),p=(a("96cf"),a("3b8d")),m=a("cebc"),f=(a("7f7f"),a("9cef")),h=a("9b5c"),v=a("17ea"),b=a("7f7d"),y=a("3e2a"),g=a("ed08"),x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{staticClass:"installment-payment",attrs:{data:t.installmentData}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),a("el-table-column",{attrs:{label:"期数"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.$index;return[t._v("第"+t._s(a+1)+"期")]}}])}),a("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row.paymentStatus;return[1===n?a("span",{staticClass:"text-orange"},[t._v("已支付")]):[t._v("未支付")]]}}])}),a("el-table-column",{attrs:{label:"付款日期"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"付款日期",disabled:t.disabled},model:{value:n.paymentDate,callback:function(e){t.$set(n,"paymentDate",e)},expression:"row.paymentDate"}})]}}])}),a("el-table-column",{attrs:{label:"付款金额"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("kld-input-number",{attrs:{min:0,precision:2,placeholder:"付款金额",disabled:t.disabled},model:{value:n.paymentAmount,callback:function(e){t.$set(n,"paymentAmount",e)},expression:"row.paymentAmount"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("￥")])])]}}])}),t.statusEditable?a("el-table-column",{attrs:{label:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row,s=e.$index;return[!t.disabled||t.editableIndexes.includes(s)?[0===n.paymentStatus?a("a",{attrs:{href:"javascript:"},on:{click:function(t){n.paymentStatus=1}}},[t._v("确认支付")]):a("a",{staticClass:"text-disabled",attrs:{href:"javascript:"},on:{click:function(t){n.paymentStatus=0}}},[t._v("取消支付")])]:t._e()]}}])}):t._e()],1)},k=[],I=(a("6c7b"),{name:"installment-payment",components:{KldCard:f["a"],KldInputNumber:h["a"]},props:{value:{type:Array,default:function(){return[]}},periods:{type:Number,default:0},total:{type:Number,default:0},disabled:Boolean,statusEditable:{type:Boolean,default:!1}},data:function(){return{editableIndexes:[]}},computed:{installmentData:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},watch:{periods:{immediate:!0,handler:function(t){if(!this.disabled){var e=this.installmentData=new Array(t).fill(!1).map(function(t,e){return{periods:e+1,paymentDate:null,paymentAmount:0,paymentStatus:0}});this.computeMoney(this.total,e)}}},total:function(t){this.disabled||this.computeMoney(t)}},created:function(){var t=this;if(this.disabled&&this.statusEditable)var e=this.$watch("installmentData",function(a){a.length>0&&(t.editableIndexes=a.map(function(t,e){return 0===t.paymentStatus?e:null}),e())},{immediate:!0})},methods:{computeMoney:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.total,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.installmentData;3===this.periods&&t>0&&[.6,.3,.1].reduce(function(a,n,s){return a-=Number(e[s].paymentAmount=(2===s?a:t*n).toFixed(2)),a},t)}}}),_=I,D=a("2877"),P=Object(D["a"])(_,x,k,!1,null,null,null),w=P.exports,C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("select-table",{staticClass:"select-supplier",attrs:{data:t.data,columns:t.columns,loading:t.loading,"current-page":t.page.current,total:t.page.total,"page-size":t.page.size,"label-key":"supplierName",remote:"","remote-method":t.remoteMethod,filterable:"","object-mode":"",width:"400px"},on:{"update:currentPage":function(e){t.$set(t.page,"current",e)},"current-change":t.getList},scopedSlots:t._u([{key:"name",fn:function(e){var n=e.row;return a("text-ellipsis",{},[t._v(t._s(n.supplierName))])}},{key:"person",fn:function(e){var n=e.row;return a("text-ellipsis",{},[t._v(t._s(n.supplierContactName))])}},{key:"phone",fn:function(e){var n=e.row;return a("text-ellipsis",{},[t._v(t._s(n.supplierPhone))])}}]),model:{value:t.valueProxy,callback:function(e){t.valueProxy=e},expression:"valueProxy"}})},$=[],N=(a("386d"),a("c680")),S=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-select",t._b({staticClass:"kld-select-table",attrs:{"value-key":t.valueKey},model:{value:t.valueProxy,callback:function(e){t.valueProxy=e},expression:"valueProxy"}},"el-select",t.$attrs,!1),[t.hasData?a("el-option",{attrs:{value:"",disabled:""}},[a("div",{staticClass:"flex",style:t.rowStyles},t._l(t.thead,function(e,n){return a("div",{key:n,class:t.columnsStyles[n].width?"flex-shrink-0":"flex-grow-lazy-1",style:t.columnsStyles[n]},[a("NodeRender",{attrs:{render:e}})],1)}),0)]):t._e(),t.hasData?t._l(t.data,function(e,n){return a("el-option",{attrs:{label:e[t.labelKey],value:e}},[a("div",{staticClass:"flex",style:t.rowStyles},t._l(t.tbody,function(s,r){return a("div",{key:r,class:t.columnsStyles[r].width?"flex-shrink-0":"flex-grow-lazy-1",style:t.columnsStyles[r]},[a("NodeRender",{attrs:{node:s({row:e,index:n})}})],1)}),0)])}):a("el-option",{staticClass:"text-center",attrs:{value:"no-data-text",disabled:""}},[t._v("\n        暂无数据\n    ")]),t.hasData&&t.hasPage?a("div",{staticClass:"text-center pt-6"},[a("el-pagination",{attrs:{total:t.total,"current-page":t.currentPageProxy,"page-size":t.pageSize,layout:"prev, pager, next, total"},on:{"update:currentPage":function(e){t.currentPageProxy=e},"current-change":function(e){t.$emit("current-change",e)}}})],1):t._e(),a("el-option",{staticClass:"none",attrs:{value:t.valueProxy,label:t.currentLabel}}),t._t("prefix",null,{slot:"prefix"})],2)},A=[],j=a("bd86"),O=a("f00f"),E={name:"NodeRender",functional:!0,props:{render:Function,node:[Array,O["b"]]},render:function(t,e){var a=e.props,n=a.render,s=a.node;return n?n(t):s}},z={name:"kld-select-table",components:{NodeRender:E},props:{value:{},data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},gutter:{type:Number,default:10},labelKey:[String,Number],valueKey:{type:[String,Number],default:"id"},currentPage:Number,total:Number,pageSize:Number,label:String,width:String,objectMode:{type:Boolean,default:!1}},data:function(){return{currentLabel:this.label}},computed:{valueProxy:{get:function(){return this.objectMode?this.value:Object(j["a"])({},this.valueKey,this.value)},set:function(t){this.objectMode||(this.currentLabel=t[this.labelKey],t=t[this.valueKey]),this.$emit("input",t)}},thead:function(){return this.columns.map(function(t){var e=t.title;return"function"===typeof e?e:function(){return Object(O["a"])(e)}})},tbody:function(){var t=this;return this.columns.map(function(e){var a=e.slot,n=e.render,s=e.key;return"string"===typeof a&&t.$scopedSlots[a]?function(e){return t.$scopedSlots[a](e)}:"function"===typeof n?function(e){return n(t.$createElement,e)}:function(t){var e=t.row;return Object(O["a"])(e[s])}})},rowStyles:function(){return{margin:"0 -".concat(this.gutterPixel),width:this.width}},columnsStyles:function(){var t=this;return this.columns.map(function(e){var a=e.width;return{width:a||0,padding:"0 ".concat(t.gutterPixel)}})},hasData:function(){return this.data.length>0},hasPage:function(){return[this.total,this.currentPage,this.pageSize].every(g["b"])},gutterPixel:function(){return"".concat(this.gutter/2,"px")},currentPageProxy:{get:function(){return this.currentPage},set:function(t){this.$emit("update:currentPage",t)}}},watch:{valueProxy:function(t){this.objectMode&&(this.currentLabel=t?t[this.labelKey]:null)}}},L=z,M=Object(D["a"])(L,S,A,!1,null,"3b0a4a5c",null),T=M.exports,K=a("ef67"),R={name:"select-supplier",mixins:[N["a"]],components:{SelectTable:T,TextEllipsis:K["a"]},props:{value:{}},data:function(){return{search:{keyword:""}}},computed:{valueProxy:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},url:function(){return"/supplier/list"},columns:function(){return[{title:"检定单位",key:"supplierName",slot:"name"},{title:"联系人",width:"100px",slot:"person"},{title:"联系方式",width:"100px",slot:"phone"}]}},created:function(){this.getList()},methods:{remoteMethod:function(t){this.search.keyword=t}}},W=R,q=Object(D["a"])(W,C,$,!1,null,"18f46971",null),B=q.exports,F=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("increment-list",{staticClass:"contract-assets",attrs:{slots:t.slots,"button-text":"新增设备"},scopedSlots:t._u([{key:"id",fn:function(e){var n=e.item;e.index;return a("increment-list-item",{},[a("template",{slot:"label"},[t._v("\n            设备名称"),a("Asterisk",{staticClass:"pl-4"})],1),a("select-asset",{attrs:{value:t.getAsset(n),placeholder:"请选择资产"},on:{input:function(e){t.setItem(n,e)}}})],2)}},{key:"brand",fn:function(t){var e=t.item;return a("increment-list-item",{attrs:{label:"设备品牌"}},[a("el-input",{attrs:{value:e.brandName,disabled:"",placeholder:"系统自动代入"}})],1)}},{key:"model",fn:function(t){var e=t.item;return a("increment-list-item",{attrs:{label:"设备型号"}},[a("el-input",{attrs:{value:e.assetClass,disabled:"",placeholder:"系统自动代入"}})],1)}},{key:"date",fn:function(e){var n=e.item;return a("increment-list-item",{},[a("template",{slot:"label"},[t._v("\n            过保日期"),a("Asterisk",{staticClass:"pl-4"})],1),a("el-date-picker",{attrs:{placeholder:"请选择过保日期",disabled:!n.assetId},model:{value:n.assetWarrntyDate,callback:function(e){t.$set(n,"assetWarrntyDate",e)},expression:"item.assetWarrntyDate"}})],2)}}]),model:{value:t.valueProxy,callback:function(e){t.valueProxy=e},expression:"valueProxy"}})},J=[],H=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"increment-list"},[t._l(t.items,function(e,n){return a("div",{key:n,staticClass:"increment-list-row flex"},[t._l(t.slots,function(s){return a("div",{key:s,staticClass:"increment-list-col flex-grow-lazy-1 flex-basis-0"},[t._t(s,null,{item:e,index:n})],2)}),a("div",{staticClass:"increment-list-col align-self-end mb-6"},[a("el-button",{staticClass:"p-2",attrs:{type:"default",size:"suit",circle:""},on:{click:function(e){t.del(n)}}},[a("i",{staticClass:"el-icon-close"})])],1)],2)}),a("div",[a("el-button",{on:{click:t.add}},[t._v(t._s(t.buttonText))])],1)],2)},U=[],G=a("db0c"),Q=a.n(G),V={name:"increment-list",props:{value:{type:Array,default:function(){return[]}},buttonText:{type:String,default:"新增"},slots:{type:Array,default:function(){return[]}}},data:function(){return{items:[]}},watch:{items:{deep:!0,immediate:!0,handler:function(t){if(0===t.length)this.add();else{var e=t.filter(function(t){return Q()(t).some(g["c"])});this.$emit("input",e),this.isInternalChange=!0}}},value:{immediate:!0,handler:function(t){this.isInternalChange?this.isInternalChange=!1:this.items=t}}},methods:{add:function(){this.items.push({})},del:function(t){this.items.splice(t,1)}}},X=V,Y=Object(D["a"])(X,H,U,!1,null,"481eec45",null),Z=Y.exports,tt={name:"increment-list-item",functional:!0,props:{label:String},render:function(t,e){var a=e.slots(),n=a.label||e.props.label;return t("div",{class:"increment-list-item"},[t("div",{class:"increment-list-item-title mb-10"},[n]),"\n                ",t("div",[a.default])])}},et=tt,at=Object(D["a"])(et,n,s,!1,null,null,null),nt=at.exports,st=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("select-table",{staticClass:"SelectAsset",attrs:{remote:"",filterable:"","remote-method":t.remoteMethod,loading:t.loading,"object-mode":"","label-key":"assetName",columns:t.columns,data:t.data,"current-page":t.page.current,total:t.page.total,"page-size":t.page.size,width:"500px"},on:{"update:currentPage":function(e){t.$set(t.page,"current",e)},"current-change":t.getList},scopedSlots:t._u([t._l(t.columns,function(e){var n=e.slot,s=e.key;return{key:n,fn:function(e){var n=e.row;return a("text-ellipsis",{key:s},[t._v(t._s(n[s]))])}}})]),model:{value:t.valueProxy,callback:function(e){t.valueProxy=e},expression:"valueProxy"}})},rt=[],lt={name:"SelectAsset",mixins:[N["a"]],components:{SelectTable:T,TextEllipsis:K["a"]},props:{value:{}},data:function(){return{search:{keyword:null}}},computed:{valueProxy:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},hospitalId:function(){return this.$store.state.userInfo.osId},url:function(){return"/assets/".concat(this.hospitalId,"/list")},columns:function(){return[{title:"设备名称",key:"assetName",slot:"name"},{title:"型号",key:"assetClass",slot:"info"},{title:"品牌",key:"brandName",slot:"brand"},{title:"所属科室",key:"osName",slot:"department"},{title:"过保时间",key:"assetWarrntyDate",slot:"date"}]}},created:function(){this.getList()},methods:{remoteMethod:function(t){this.search.keyword=t}}},it=lt,ot=Object(D["a"])(it,st,rt,!1,null,null,null),ct=ot.exports,ut=a("f707"),dt={name:"contract-assets",components:{IncrementList:Z,IncrementListItem:nt,Asterisk:ut["a"],SelectAsset:ct},props:{value:{}},computed:{valueProxy:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},slots:function(){return["id","brand","model","date"]}},methods:{getAsset:function(t){return{id:t.assetId,assetName:t.assetName}},setItem:function(t,e){this.$set(t,"assetId",e.id),this.$set(t,"assetWarrntyDate",e.assetWarrntyDate),this.$set(t,"departmentId",e.departmentId),this.$set(t,"hosId",e.hosId),this.$set(t,"assetName",e.assetName),this.$set(t,"brandName",e.brandName),this.$set(t,"assetClass",e.assetClass)}}},pt=dt,mt=Object(D["a"])(pt,F,J,!1,null,"0943e97b",null),ft=mt.exports,ht=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("increment-list",{ref:"increment-list",staticClass:"contract-spare-parts",attrs:{slots:t.slots,"button-text":"新增备件"},scopedSlots:t._u([{key:"name",fn:function(e){var n=e.item;return a("increment-list-item",{attrs:{label:"备件名称"}},[a("el-input",{attrs:{disabled:!t.hasAsset,placeholder:"请输入备件名称"},model:{value:n.sparePartName,callback:function(e){t.$set(n,"sparePartName",e)},expression:"item.sparePartName"}})],1)}},{key:"model",fn:function(e){var n=e.item;return a("increment-list-item",{},[a("template",{slot:"label"},[t._v("备件型号"),a("Asterisk",{staticClass:"pl-4"})],1),a("el-input",{attrs:{disabled:!n.sparePartName,placeholder:"请输入备件型号"},model:{value:n.sparePartModel,callback:function(e){t.$set(n,"sparePartModel",e)},expression:"item.sparePartModel"}})],2)}},{key:"asset",fn:function(e){var n=e.item;return a("increment-list-item",{},[a("template",{slot:"label"},[t._v("所属设备"),a("Asterisk",{staticClass:"pl-4"})],1),a("el-select",{attrs:{disabled:!n.sparePartName,placeholder:"请选择所属设备"},model:{value:n.assetId,callback:function(e){t.$set(n,"assetId",e)},expression:"item.assetId"}},t._l(t.assets,function(t){var e=t.assetId,n=t.assetName;return a("el-option",{key:e,attrs:{label:n,value:e}})}),1)],2)}},{key:"amount",fn:function(e){var n=e.item;return a("increment-list-item",{},[a("template",{slot:"label"},[t._v("备件数量"),a("Asterisk",{staticClass:"pl-4"})],1),a("kld-input-number",{attrs:{min:0,percision:0,disabled:!n.sparePartName,placeholder:"请输入备件数量"},model:{value:n.sparePartNum,callback:function(e){t.$set(n,"sparePartNum",e)},expression:"item.sparePartNum"}})],2)}}]),model:{value:t.valueProxy,callback:function(e){t.valueProxy=e},expression:"valueProxy"}})},vt=[],bt={name:"contract-spare-parts",components:{IncrementList:Z,IncrementListItem:nt,Asterisk:ut["a"],KldInputNumber:h["a"]},props:{value:{},assets:{type:Array,default:function(){return[]}}},computed:{valueProxy:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},slots:function(){return["name","model","asset","amount"]},hasAsset:function(){return this.assets.length>0}},watch:{assets:function(t){var e=this.valueProxy,a=e.filter(function(e){var a=e.assetId;return t.some(function(t){var e=t.assetId;return e===a})});e.length!==a.length&&(this.valueProxy=a)}}},yt=bt,gt=Object(D["a"])(yt,ht,vt,!1,null,null,null),xt=gt.exports,kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("select-tag",{staticClass:"select-contract-tag",attrs:{data:t.tags,"label-key":"labelName",max:5},model:{value:t.valueProxy,callback:function(e){t.valueProxy=e},expression:"valueProxy"}})},It=[],_t=a("0d0a"),Dt={name:"select-contract-tag",components:{SelectTag:_t["a"]},props:{value:{type:Array,default:function(){return[]}}},data:function(){return{tags:[]}},computed:{valueProxy:{get:function(){return this.value},set:function(t){this.$emit("input",t)}}},created:function(){this.getTags()},methods:{getTags:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.post("/labels/list/3");case 2:e=t.sent,a=e.data,this.tags=a;case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},Pt=Dt,wt=Object(D["a"])(Pt,kt,It,!1,null,null,null),Ct=wt.exports,$t={name:"contract-add",components:{KldCard:f["a"],KldInputNumber:h["a"],KldFormItem:v["a"],Portal:b["a"],FileUpload:y["a"],InstallmentPayment:w,SelectSupplier:B,ContractAssets:ft,ContractSpareParts:xt,SelectContractTag:Ct},data:function(){return{formData:{contractCode:null,contractName:null,signDate:null,contractType:null,supplierId:null,supplierName:null,supplierContactor:null,supplierContact:null,purchaseAmount:null,contractStatus:0,periodsNum:0,paymentInstalments:[],labelIds:[],pics:[],spareParts:[],assetIds:[]},submitLoading:!1,loading:!1}},computed:{formRules:function(){return{contractCode:{required:!0,message:"合同编号为必填"},contractName:{required:!0,message:"合同名称为必填"},signDate:{required:!0,message:"签订日期为必填"},contractType:{required:!0,message:"合同类型为必填"},supplierId:{required:!0,message:"供应商为必填"}}},periods:{get:function(){return this.formData.periodsNum},set:function(t){this.formData.periodsNum=Object(g["c"])(t)?t:0}},supplier:{get:function(){var t=this.formData;return{id:t.supplierId,supplierName:t.supplierName}},set:function(t){var e=this.formData;e.supplierId=t.id,e.supplierName=t.supplierName,e.supplierContactor=t.supplierContactName,e.supplierContact=t.supplierPhone}},hospitalId:function(){return this.$store.state.userInfo.osId},imageAction:function(){return"/photo/".concat(this.hospitalId,"/2/upload")},routeName:function(){return this.$route.name},isAdd:function(){return"contract-add"===this.routeName},isEdit:function(){return"contract-edit"===this.routeName},clearAssets:function(){return this.formData.assetIds.map(function(t){var e=t.assetId,a=t.assetWarrntyDate,n=t.departmentId,s=t.hosId;return{assetId:e,assetWarrntyDate:a,departmentId:n,hosId:s}})},submitConfig:function(){var t=Object(m["a"])({},this.formData);return t.assetIds=this.clearAssets,{method:this.isAdd?"post":"put",url:"/contracts/".concat(this.hospitalId,"/").concat(this.isAdd?"":this.queryId),data:Object(m["a"])({},t)}}},methods:{submit:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.form.validate();case 2:if(!(this.validateAssets()&&this.validateSpareParts()&&this.validateInstallment())){t.next=14;break}return this.submitLoading=!0,t.prev=4,t.next=7,this.$refs["file-upload"].upload();case 7:return t.next=9,this.$axios(this.submitConfig);case 9:this.$message({type:"success",message:this.isAdd?"新增成功":"修改成功"}),this.goBack();case 11:return t.prev=11,this.submitLoading=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[4,,11,14]])}));function e(){return t.apply(this,arguments)}return e}(),validateAssets:function(){var t=this.formData.assetIds.every(function(t){return Object(g["c"])(t.assetWarrntyDate)});return t||this.$message({type:"warning",message:"设备过保日期为必填"}),t},validateSpareParts:function(){var t={sparePartName:"备件名称为必填",sparePartModel:"备件型号为必填",assetId:"备件所属设备为必填",sparePartNum:"备件数量为必填"},e=!0,a=!1,n=void 0;try{for(var s,r=d()(this.formData.spareParts);!(e=(s=r.next()).done);e=!0)for(var l=s.value,o=c()(t),u=0;u<o.length;u++){var p=Object(i["a"])(o[u],2),m=p[0],f=p[1];if(!Object(g["c"])(l[m]))return this.$message({type:"warning",message:f}),!1}}catch(h){a=!0,n=h}finally{try{e||null==r.return||r.return()}finally{if(a)throw n}}return!0},validateInstallment:function(){var t=this.formData,e=t.paymentInstalments,a=t.purchaseAmount;if(e.length>0){if(!e.every(function(t){var e=t.paymentDate;return e}))return this.$message({type:"warning",message:"分期付款日期为必填"}),!1;if(Number(e.reduce(function(t,e){var a=e.paymentAmount;return t+Number(a)},0).toFixed(2))!==a)return this.$message({type:"warning",message:"分期总金额必须等于采购金额"}),!1}return!0},goBack:function(){this.$router.back()}}},Nt=$t,St=Object(D["a"])(Nt,r,l,!1,null,null,null);e["a"]=St.exports},ef67:function(t,e,a){"use strict";var n,s,r=a("2638"),l=a.n(r),i=a("2b0e"),o=a("f00f"),c={name:"text-ellipsis",functional:!0,props:{tag:{type:[String,i["default"]],default:"p"},title:{type:String}},render:function(t,e){var a=e.props.tag,n=e.slots().default,s=e.props.title||Object(o["c"])(n).trim();return t(a,l()([{},e.data,{class:"text-ellipsis",attrs:{title:s}}]),[n])}},u=c,d=a("2877"),p=Object(d["a"])(u,n,s,!1,null,null,null);e["a"]=p.exports},f00f:function(t,e,a){"use strict";a.d(e,"a",function(){return o}),a.d(e,"d",function(){return u}),a.d(e,"c",function(){return d}),a.d(e,"b",function(){return c});var n=a("5d73"),s=a.n(n),r=a("a745"),l=a.n(r),i=a("2b0e"),o=i["default"].prototype._v,c=o().constructor,u=function(t){return t instanceof c},d=function t(e){var a="";l()(e)||(e=[e]);var n=!0,r=!1,i=void 0;try{for(var o,c=s()(e);!(n=(o=c.next()).done);n=!0){var d=o.value;u(d)&&(l()(d.children)?a+=t(d.children):d.componentOptions&&l()(d.componentOptions.children)?a+=t(d.componentOptions.children):"string"===typeof d.text?a+=d.text:d.elm&&(a+=d.elm.textContent))}}catch(p){r=!0,i=p}finally{try{n||null==c.return||c.return()}finally{if(r)throw i}}return a}}}]);
//# sourceMappingURL=chunk-d40e0f3e.f363e3e1.js.map